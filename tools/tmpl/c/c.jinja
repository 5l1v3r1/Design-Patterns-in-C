{%- extends '_source.jinja' -%}
{%- import '_macro.jinja' as func -%}

{% block file_header %}{% if add_file_header -%}
{{ func.file_header(file_header_name,copyright,author,date,summary) }}
{% endif %}{% endblock %}

{%- block private_method -%}
{{ func.macro_loop_functions(name,methods,mode='impl',impl_as='printf',qualifier='static',format_str='%s_%s') }}
{%- endblock -%}

{%- block vtable_impl -%}
{{ func.macro_loop_functions(name,virtuals,mode='impl',impl_as='printf',qualifier='static',format_str='%s_ops_%s') }}
{%- endblock -%}

{%- block vtable_set %}
static struct {{ name }}_ops {{ name }}_ops = {
{{ func.macro_loop_functions(name,virtuals,mode='assign',format_str='%s_ops_%s') }}
};
{%- endblock -%}


{%- block supers -%}
{%- if supers -%}
{%- for parent_name,parent_vtables in supers.iteritems() -%}
	{%- for vtable_class_name,vtable_class_detail in parent_vtables.iteritems() -%}
		{{- func.macro_loop_functions(name,vtable_class_detail['virtuals'],mode='impl',impl_as='printf',abstract_name=vtable_class_name,qualifier='static',format_str='%s_ops_%s') }}
{# parent ops #}
static struct {{ vtable_class_name }}_ops {{ vtable_class_name }}_ops = {
	{{ func.macro_loop_functions(name,vtable_class_detail['virtuals'],mode='assign',abstract_name=vtable_class_name,format_str='%s_ops_%s') }}
};
{# end parent ops #}
	{%- endfor -%}
{%- endfor -%}
{%- endif -%}
{%- endblock -%}


{%- block init -%}
{# init implement #}
void {{ name }}_init(struct {{ name }} *{{ name }})
{
	memset({{ name }}, sizeof(*{{ name }}), 0);
{%- if supers -%}
{%- for parent_name,parent_vtables in supers.iteritems() %}
	{{ parent_name }}_init(&{{ name }}->{{ parent_name }});
	{%- for vtable_class_name,vtable_class_detail in parent_vtables.iteritems() %}
	CLASS_OPS_INIT({{ name }}->{{ vtable_class_detail['detail'] }}.ops, {{ vtable_class_name }}_ops);
	{%- endfor -%}
{%- endfor -%}
{% endif -%}

{%- if _have_vtable_new %}
	{{ name }}->ops = &{{ name }}_ops;
{%- endif %}
}
{# end init implement #}
{%- endblock -%}

{%- block public_method -%}
	{{- func.macro_loop_functions(name,routines,mode='impl',impl_as='printf',format_str='%s_%s') }}
{%- endblock -%}
