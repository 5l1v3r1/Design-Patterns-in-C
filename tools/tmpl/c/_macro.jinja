{# function generate temple macro list
ref:	{%- import '_macro.jinja' as func -%}
use:	{{ func.macro_loop_functions(name,'static',routines,'printf') }}
#}
{% include '_common.jinja' %}

{##################################}
{%- macro macro_function_impl_as_ops(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -%}
{%- if func_args %}
	{{ name }}->ops->{{ func }}({{ name }}, {{ func_args }});
{%- else %}
	{{ name }}->ops->{{ func }}({{ name }});
{%- endif -%}

	{%- if rtn_type[-1] == '*' %}
	return 0;
	{%- elif rtn_type == 'char *' %}
	return 0;
	{%- elif rtn_type == 'int' %}
	return 0;
	{%- endif -%}
{%- endmacro -%}


{##################################}
{%- macro macro_function_impl_as_printf(name,qualifier,func_scope,rtn_type,func,format_str,func_args) %}
	printf("{{ qualifier }} {{ rtn_type }} {{ name }}::{{ func }}()\n");
	{%- if rtn_type[-1] == '*' %}
	return 0;
	{%- elif rtn_type == 'char *' %}
	return 0;
	{%- elif rtn_type == 'int' %}
	return 0;
	{%- endif -%}
{% endmacro -%}


{##################################}
{%- macro macro_function_impl(name,qualifier,func_scope,rtn_type,func,format_str,func_args) %}
{% if qualifier %}
{{ qualifier }}
{%- endif -%}
{% if func_args %}
{{ rtn_type }} {{ format_str|format(name,func) }}(struct {{ name }} *{{ name }}, {{ func_args }})
{
	{{ caller() }}
}
{% else %}
{{ rtn_type }} {{ format_str|format(name,func) }}(struct {{ name }} *{{ name }})
{
	{{ caller() }}
}
{%- endif -%}
{%- endmacro -%}


{##################################}
{%- macro macro_function_declare_as_ops(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -%}
{%- if func_args %}
	{{ rtn_type }} (*{{ func }})(struct {{ name }} *, {{ func_args }});
{%- else %}
	{{ rtn_type }} (*{{ func }})(struct {{ name }} *);
{%- endif -%}
{%- endmacro -%}


{##################################}
{%- macro macro_function_declare_as_func(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -%}
{%- if func_args %}
{{ rtn_type }} {{ format_str|format(name,func) }}(struct {{ name }} *, {{ func_args }});
{%- else %}
{{ rtn_type }} {{ format_str|format(name,func) }}(struct {{ name }} *);
{%- endif -%}
{%- endmacro -%}


{##################################}
{%- macro macro_function_assign(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -%}
{{ x }}	.{{ func }} = {{ format_str|format(name,func) }},
{% endmacro -%}


{##################################}
{%- macro macro_variable(name,qualifier,func_scope,rtn_type,func,format_str,func_args) %}
	{{ rtn_type }} {{ func }}{{ func_args }};
{%- endmacro -%}


{##################################}
@qualifier static inline
@functions forearch functions list
@mode implement as [ops|printf]
#}
{%- macro macro_loop_functions(name,qualifier,functions,format_str,mode,impl_as) -%}
	{%- for func_scope,rtn_type,func,func_args in functions -%}
		{%- if mode == "var" -%}
			{{- macro_variable(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -}}
		{%- elif mode == "declare" -%}
			{%- if impl_as == "ops" -%}
				{{- macro_function_declare_as_ops(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -}}
			{%- elif impl_as == "func" -%}
				{{- macro_function_declare_as_func(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -}}
			{%- endif -%}
		{%- elif mode == "assign" -%}
			{{- macro_function_assign(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -}}
		{%- elif mode == "impl" -%}
			{%- call macro_function_impl(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -%}
				{%- if impl_as == "ops" -%}
					{{- macro_function_impl_as_ops(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -}}
				{%- elif impl_as == "printf" -%}
					{{- macro_function_impl_as_printf(name,qualifier,func_scope,rtn_type,func,format_str,func_args) -}}
				{%- endif -%}
			{%- endcall -%}
		{%- endif -%}
	{%- endfor -%}
{%- endmacro -%}

